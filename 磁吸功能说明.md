# 自动磁吸连线功能说明

## 📋 功能概述

磁吸功能为电路设计平台提供了两种智能对齐功能：
1. **网格磁吸** - 组件拖拽时自动对齐到网格线
2. **自动磁吸连线** - 连线时自动磁吸并连接到最近的锚点

## 🎯 功能特性

### **1. 网格磁吸功能**
- **触发条件**: 拖拽组件时
- **磁吸距离**: 15像素内自动对齐
- **网格大小**: 20×20像素（与背景网格一致）
- **视觉反馈**: 绿色圆点指示器显示对齐位置

### **2. 自动磁吸连线功能**
- **触发条件**: 拖拽连线时
- **磁吸距离**: 50像素内自动磁吸（大幅增加，更容易连接）
- **智能排除**: 自动排除起始锚点，避免自连接
- **视觉反馈**:
  - 橙色脉冲圆圈指示器显示目标锚点
  - 连线变为橙色并加粗，表示即将连接
- **自动连接**: 松开鼠标时自动连接到磁吸范围内的锚点

### **3. 完全自动化**
- **无需手动控制**: 磁吸功能始终开启
- **无需精确对准**: 只需大致接近锚点即可自动连接
- **智能识别**: 自动识别最近的可连接锚点

## 🔧 技术实现

### **文件结构**
```
magnetic-snap.js          # 磁吸功能核心类
test1 (1).html            # 主页面（已集成磁吸功能）
extracted-styles.css      # 样式文件
```

### **核心类: MagneticSnap**

#### **初始化参数**
```javascript
const magneticSnap = new MagneticSnap({
    gridSize: 20,           // 网格大小
    snapDistance: 15,       // 网格磁吸距离
    anchorSnapDistance: 25, // 锚点磁吸距离
    enabled: true           // 是否启用
});
```

#### **主要方法**
- `snapToGrid(x, y, canvas)` - 网格对齐
- `snapToAnchor(x, y, canvas, exclude)` - 锚点磁吸
- `snapComponentToGrid(component, x, y, canvas)` - 组件网格对齐
- `enable()` / `disable()` / `toggle()` - 控制开关

## 🎮 使用方法

### **网格磁吸**
1. 点击或拖拽任意组件
2. 拖拽过程中，当组件接近网格交叉点时
3. 会出现绿色圆点指示器
4. 松开鼠标，组件自动对齐到网格

### **自动磁吸连线**
1. 从任意锚点开始拖拽连线
2. 拖拽过程中，当接近其他锚点时（50像素内）
3. 会出现橙色脉冲圆圈指示器
4. 连线变为橙色并加粗，表示即将连接
5. **无需精确对准**，松开鼠标即可自动连接到最近的锚点

### **完全自动化操作**
- **无需开关控制**: 磁吸功能始终开启
- **无需精确操作**: 大致接近目标即可自动连接
- **智能避免错误**: 自动排除不合理的连接目标

## 🎨 视觉指示器

### **网格磁吸指示器**
- **样式**: 绿色圆点，白色边框
- **大小**: 8×8像素
- **位置**: 目标网格交叉点
- **阴影**: 绿色光晕效果

### **自动磁吸指示器**
- **样式**: 橙色脉冲圆圈，半透明背景
- **大小**: 24×24像素（更大更明显）
- **位置**: 目标锚点中心
- **动画**: 脉冲动画效果，更容易注意
- **连线反馈**: 连线变橙色加粗，表示即将连接

## ⚙️ 配置选项

### **可调整参数**
```javascript
// 在 test1 (1).html 第218行附近修改
const magneticSnap = new MagneticSnap({
    gridSize: 20,           // 网格大小 (建议: 10-40)
    snapDistance: 15,       // 网格磁吸距离 (建议: 10-30)
    anchorSnapDistance: 25, // 锚点磁吸距离 (建议: 15-40)
    enabled: true           // 默认状态
});
```

### **自定义样式**
可以通过修改 `magnetic-snap.js` 中的 `createIndicators()` 方法来自定义指示器样式。

## 🔍 调试信息

### **控制台方法**
```javascript
// 在浏览器控制台中使用
magneticSnap.enable();     // 启用磁吸
magneticSnap.disable();    // 禁用磁吸
magneticSnap.toggle();     // 切换状态
```

### **状态检查**
```javascript
console.log(magneticSnap.enabled); // 查看当前状态
```

## 🚀 性能优化

### **优化特性**
- **智能计算**: 只在拖拽时进行磁吸计算
- **距离优化**: 超出磁吸距离时不进行复杂计算
- **DOM优化**: 指示器复用，避免频繁创建/销毁
- **事件优化**: 使用事件委托，减少内存占用

### **兼容性**
- **浏览器**: 支持所有现代浏览器
- **设备**: 支持鼠标和触摸操作
- **分辨率**: 自适应不同屏幕分辨率

## 🛠️ 故障排除

### **常见问题**

#### **磁吸不工作**
1. 检查磁吸开关是否开启（工具栏图标是否高亮）
2. 确认 `magnetic-snap.js` 文件已正确加载
3. 检查浏览器控制台是否有错误信息

#### **磁吸距离不合适**
1. 修改初始化参数中的 `snapDistance` 和 `anchorSnapDistance`
2. 重新加载页面使设置生效

#### **指示器不显示**
1. 检查CSS样式是否被覆盖
2. 确认指示器元素已正确创建
3. 检查z-index层级设置

## 📝 更新日志

### **v1.0.0** (当前版本)
- ✅ 实现网格磁吸功能
- ✅ 实现锚点磁吸功能
- ✅ 添加视觉指示器
- ✅ 添加磁吸开关控制
- ✅ 集成到主系统

### **未来计划**
- 🔄 添加磁吸强度调节
- 🔄 支持自定义磁吸规则
- 🔄 添加磁吸音效反馈
- 🔄 支持多种对齐模式
